)
التطبيق ده يا صاحبي، هو نظام محاسبي متكامل هيشتغل كـ "تطبيق ويب تفاعلي" (Web PWA). يعني إيه؟ يعني هيتفتح عادي من أي متصفح (كروم، فايرفوكس، إيدج) على أي جهاز (كمبيوتر، لاب توب، تابلت، موبايل)، وممكن كمان تثبته على شاشة جهازك كأنه تطبيق عادي مستقل، ويقدر يشتغل أونلاين وأوفلاين (حتى لو النت قطع). المؤسسة دي اسمها"ابو فرحان للنقل الخفيف" (بتبيع موتوسيكلات، تروسيكلات، سكوتر كهرباء، وتكاتك). الهدف الأساسي إن كل شغل المؤسسة ده (إدارة مخازن، بيع وشراء، حسابات فلوس، متابعة مستندات زي "جواب الموتوسيكل") يبقى كله رقمي على التطبيق ده، عشان نلغي الورق تماماً ونخلي الشغل منظم، سهل، سريع، والأهم من غير غلطات.


**أهم نقطة هنا: مفهوم الوكيل المتكامل:**
سيتم التعامل مع الوكلاء بطريقتين:
1.  **وكلاء يستخدمون التطبيق بأنفسهم (Agents with User Accounts):** وهؤلاء هم الوكلاء الذين يمتلكون حسابات على التطبيق، يمكنهم تسجيل الدخول، إدارة مخازنهم الفرعية الخاصة بهم، إنشاء فواتير البيع للعملاء النهائيين، ورؤية كشوفات حساباتهم.
2.  **وكلاء أوفلاين لا يمتلكون مستخدمين في التطبيق (Offline Agents without User Accounts):** وهؤلاء وكلاء خارجيون لا يستخدمون التطبيق مباشرة. **تتم إدارة جميع حساباتهم (البضاعة المحولة إليهم، مبيعاتهم التي تُبلغ للمؤسسة، ودفعاتهم المالية) بشكل كامل بواسطة المديرين الإداريين أو المدير الأعلى داخل التطبيق على حساب هذا الوكيل**.

**لكلا النوعين من الوكلاء، سيتم التعامل معهم كـ "عميل" للمؤسسة**. لهم حساب مالي خاص بهم يضم فواتير بضاعة مستحقة للمؤسسة ودفعات يقومون بها. **مديونيتهم تتغير بناءً على سعر البيع النهائي للعميل**، حيث تشمل مديونيته سعر الشراء الأصلي بالإضافة إلى نصيب المؤسسة من الربح بعد البيع النهائي للعميل. كل وكيل (سواء كان مستخدم للتطبيق أم لا) سيكون له مخزن مستقل مرتبط بحسابه.

**رؤية مستقبلية:** في المستقبل، سيتم تطوير نسخة من هذا التطبيق تعمل على نظام تشغيل Windows، لخدمة أجهزة الكمبيوتر المكتبية والمحمولة.

**الهدف الأساسي من التطبيق:**
رقمنة وتبسيط إدارة المخزون، عمليات البيع، تتبع الأرباح، وإدارة شاملة لحسابات الوكلاء كنظام عملاء/موردين (Vendors/Customers) مع المؤسسة ونقطة البيع الرئيسية للمؤسسة (المعرض)، بالإضافة إلى تتبع دقيق لعملية استخراج وتسليم "جواب" الموتوسيكل حتى وصوله لنقطة البيع.

**النتائج المرجوة من التطبيق (Desired Outcomes):**
يهدف التطبيق إلى تحقيق نظام محاسبي رقمي "لاورقي" (Paperless)، يقلل الأخطاء البشرية بشكل كبير، ويوفر رؤية شاملة ودقيقة لكل العمليات المالية والمخزنية. سيمكن كل طرف من الوصول الفوري للبيانات والمعلومات والصلاحيات الخاصة به فقط. هذا النظام سيضمن عدم نسيان أي خطوة في عملية وصول "الجواب" لنقطة البيع لتسليمه للعميل النهائي، وتسجيل جميع المعاملات المالية (فواتير البضاعة، المدفوعات، أرصدة مديونية الوكلاء المتغيرة بناءً على الأرباح) بين الوكلاء والمؤسسة بوضوح ودقة عالية. كما سيوفر قدرة بحث واستعلام شاملة للمستخدمين الداخليين عن كل ما يخص العملاء النهائيين ومشترياتهم.

### **2. الملامح الأساسية للتطبيق (Core Features)**

#### **2.1. إدارة المخزون وتفاصيل الأصناف (Inventory Management & Item Details):**

##### **2.1.1. شاشة تسجيل الأصناف (Item Registration Screen):**
*   إضافة تفاصيل كاملة لكل صنف جديد يدخل المخزن: النوع، الموديل، اللون، الماركة، بلد المنشأ، سنة الصنع، السعر الأساسي للشراء (التكلفة).
*   **إدارة رقم الشاسيه (Chassis Number) وبصمة الموتور كمعرفات فريدة مع دعم التعرف الضوئي على الحروف (OCR):**
    *   **المطلب الأهم والحاسم:** يجب التقاط **صورة واضحة لبصمة الموتور وصورة واضحة لرقم الشاسيه** لكل صنف بواسطة كاميرا التطبيق مباشرة.
    *   ستُستخدم **تقنية التعرف الضوئي على الحروف (OCR)** لتحليل الصور واستخلاص الأرقام والحروف منها وتحويلها تلقائياً إلى نصوص رقمية قابلة للبحث والتخزين لكل من بصمة الموتور ورقم الشاسيه.
    *   يجب أن يسمح التطبيق للمستخدم بـ**مراجعة وتعديل النصوص الرقمية المستخلصة من الـ OCR يدوياً** لضمان الدقة الكاملة قبل الحفظ. هذه الخطوة حاسمة لسلامة البيانات.
    *   سيتم تخزين كل من صور بصمة الموتور ورقم الشاسيه الأصلية (كمرجع مرئي وللتوثيق في الفواتير) والنصوص الرقمية المستخرجة والمعتمدة لكل منهما (للتتبع، البحث، الفرز، والظهور في الفواتير والتقارير).
    *   النص الرقمي لبصمة الموتور و/أو رقم الشاسيه سيكونان **معرّفين فريدين (Unique ID / Primary Key)** لكل صنف في قاعدة البيانات، مما يمنع تكرار الأصناف ويجعل تتبعها سهلاً ودقيقاً في جميع الحركات.

##### **2.1.2. تتبع المخزون عبر المخازن المتعددة (Multi-Warehouse Tracking):**
*   **المخزن الرئيسي للمؤسسة (Main Warehouse):** لإدارة الأصناف الجديدة الواردة إلى المؤسسة قبل توزيعها.
*   **مخزن المعرض (Showroom Warehouse):** يُعامل كمخزن فرعي ونقطة بيع رئيسية تابعة للمؤسسة. أي بيع يتم من هذا المخزن يذهب ربحه بالكامل للمؤسسة (لا تقسيم أرباح).
*   **مخازن الوكلاء (Agent Warehouses):** لكل وكيل مخزن فرعي خاص به. البضاعة المحولة إليه سيتم تسجيلها كـ**فاتورة مبيعات للمؤسسة على حساب الوكيل بقيمة سعر الشراء الأصلي، مما يؤثر على رصيده المالي كعميل**.

##### **2.1.3. شاشات عرض المخزون (Organized Inventory Display Screens):**
*   **شاشات المخازن عند المديرين يجب أن تكون مرتبة ومنظمة جيداً لتجنب اللخبطة، مع خيارات بحث وفرز واضحة**.
*   عرض المخزون الحالي لكل مخزن بشكل منفصل، مع إمكانية البحث والفرز بناءً على النص الرقمي لبصمة الموتور أو رقم الشاسيه أو أي تفاصيل أخرى.
*   إظهار تفاصيل الأصناف المتاحة، المباعة، أو المعلقة (تحت التحويل).

#### **2.2. إدارة المبيعات والفواتير (Sales & Invoicing Management):**

##### **2.2.1. إنشاء فواتير البيع للعملاء النهائيين (End-Customer Invoice Creation):**
*   شاشة مخصصة لإنشاء فواتير بيع رقمية مفصلة.
*   **بيانات العميل وتوثيق الهوية (OCR & Image Capture):**
    *   تسجيل شامل لاسم المشتري، رقم الهاتف، والعنوان.
    *   **المطلب الجديد:** يجب أن يطلب التطبيق **تصوير بطاقة الهوية الوطنية للعميل (وش وظهر)** باستخدام كاميرا التطبيق.
    *   يجب توجيه المستخدم بوضوح حول طريقة التصوير الصحيحة (إضاءة جيدة، زاوية مستقيمة، البطاقة داخل الإطار المحدد) لضمان جودة الصور القابلة للطباعة لاحقاً.
    *   ستُستخدم **تقنية OCR** لـاستخلاص البيانات الأساسية من البطاقة (مثل: الاسم بالكامل، الرقم القومي، العنوان، تاريخ الإصدار/الانتهاء) ووضعها في الحقول المخصصة بالفاتورة. يجب على المستخدم مراجعة وتأكيد دقة هذه البيانات.
    *   سيتم تخزين صور البطاقة (الوجهين) المرفقة مع بيانات الفاتورة.
*   تفاصيل الصنف المباع: اختيار الصنف عن طريق النص الرقمي لبصمة الموتور أو رقم الشاسيه الخاص به.
*   **إرفاق صور بصمة الموتور ورقم الشاسيه:** يجب أن تظهر صورة بصمة الموتور وصورة رقم الشاسيه بوضوح ضمن تفاصيل الفاتورة كدليل بصري ومرجع.
*   سعر البيع: إدخال سعر البيع النهائي للصنف.

##### **2.2.2. حساب الأرباح تلقائياً (Automated Profit Calculation):**
*   **لمبيعات من مخازن الوكلاء (عمولة متغيرة):** يُقسم الربح (سعر البيع النهائي للعميل - سعر الشراء/التكلفة الأساسية للمؤسسة) **بناءً على نسبة العمولة المحددة لكل موتوسيكل أثناء تحويله للوكيل**. **نصيب المؤسسة من المكسب (بناءً على العمولة المتغيرة) ستضاف إلى مديونية الوكيل الأصلية (قيمة سعر الشراء الأصلي للبضاعة المحولة إليه).**.
*   لمبيعات من المخزن الرئيسي أو مخزن المعرض: الربح بالكامل يذهب للمؤسسة (100%).
*   يجب أن تظهر نسبة الربح لكل طرف بوضوح في ملخص الفاتورة أو تقرير البيع.

##### **2.2.3. تسجيل حركات البيع والمرتجعات (Sales & Return Transaction Logging):**
*   كل عملية بيع أو ارتجاع ستُسجل بشكل مفصل مع تاريخ ووقت العملية، والمستخدم الذي قام بها.
*   **أرقام تسلسلية فريدة لكل حركة (Unique Transaction IDs):**
    *   الإدخالات المخزنية: رقم إدخال مخزني فريد (مثال: IN-YYMMDD-001).
    *   فواتير البضاعة المحولة للوكلاء: رقم فاتورة مبيعات للمؤسسة على الوكيل (مثال: INV-AGENT-YYMMDD-001). هذه الفواتير تنشأ عند تحويل البضاعة للوكيل.
    *   فواتير البيع للعملاء النهائيين: رقم فاتورة فريد (مثال: INV-YYMMDD-010).
    *   مرتجعات البيع: رقم مرتجع بيع فريد (مثال: RET-YYMMDD-001).
    *   سندات القبض (المدفوعات من الوكلاء): رقم سند قبض فريد (مثال: RCPT-YYMMDD-001).
    *   يجب أن يضمن النظام توليد هذه الأرقام بشكل آمن وفريد (لا تكرار)، مع تضمين التاريخ كجزء من الرقم لسهولة التتبع والفرز.
*   **التتبع الشامل ببصمة الموتور ورقم الشاسيه:** كل حركة في النظام يجب أن تكون مرتبطة بشكل مباشر بالنص الرقمي لبصمة الموتور ورقم الشاسيه الخاصة بالصنف، مما يتيح تتبع تاريخ الصنف بالكامل.

#### **2.3. إدارة حسابات الوكلاء (كنظام عملاء للمؤسسة - Agent as Customer System):**
*   **صفحة حساب الوكيل:** لكل وكيل (سواء مستخدم للتطبيق أو أوفلاين يديره إداريون) حساب خاص به يعرض:
    *   قائمة بالبضاعة الموجودة حالياً في مخزنه (مع بصماتها كـنص رقمي وأرقام الشاسيه).
    *   **الرصيد المالي المستحق على الوكيل للمؤسسة (مدين/دائن):** هذا الرصيد يجب أن يعكس إجمالي **المديونية المتغيرة** التي تشمل قيمة البضاعة المحولة إليه بسعر الشراء الأصلي، بالإضافة إلى نصيب المؤسسة من الأرباح المحققة من مبيعاته النهائية..
    *   سجل الفواتير المستحقة: عرض الفواتير التي تم إصدارها على الوكيل مقابل البضاعة المحولة إليه.
    *   **تسجيل الدفعات (سندات القبض - حصري للمديرين، ويشمل الوكلاء الأوفلاين):** شاشة مخصصة لـتسجيل الدفعات المالية التي قام بها الوكيل للمؤسسة، تتضمن (المبلغ، تاريخ الدفع، طريقة الدفع، ورقم سند القبض الفريد). **هذه الشاشة متاحة فقط للمدير الأعلى والمديرين الإداريين. الوكلاء لا يمكنهم تسجيل دفعات لأنفسهم**.
*   **القدرة على إنشاء فواتير بيع للعملاء النهائيين من مخزنه الخاص فقط.** (هذه الصلاحية خاصة بالوكلاء الذين يمتلكون حسابات على التطبيق، أما الوكلاء الأوفلاين فيتم تسجيل مبيعاتهم من قبل الإداريين).
*   **كشف حساب مفصل (بيان حركة):** إمكانية الوكيل (أو المدير/الإداري الذي يدير حساب وكيل أوفلاين) لرؤية كشف حساب مفصل يوضح:
    *   البضاعة التي استلمها من المؤسسة (مع روابط الفواتير المستحقة).
    *   جميع المبيعات التي قام بها للعملاء النهائيين، مع تفصيل نصيبه من الأرباح ونسبة المؤسسة.
    *   تفاصيل الدفعات التي قام بها للمؤسسة.
    *   حساب الرصيد المالي الحالي المتغير الذي يعكس كل هذه العمليات (المديونية الناتجة عن البضاعة ونسبة المؤسسة في الأرباح مطروحاً منها الدفعات).

#### **2.4. نظام تتبع "الجواب" (Document Tracking System):**
*   **شاشة مخصصة لتتبع الجوابات (Dedicated Document Tracking Screen):** يجب توفير شاشة منفصلة داخل التطبيق تعرض فقط حالات تتبع "الجوابات" (شهادات بيانات الموتوسيكلات)، لتسهيل المتابعة والبحث.
*   ربط تتبع الجواب بكل صنف مباع: كل موتوسيكل يتم بيعه (عن طريق فاتورة للعميل النهائي) سيكون له حالة تتبع خاصة بـ "الجواب" الخاص به.
*   **مراحل التتبع (قابلة للتخصيص ومحددة):**
    *   "تم إرسال بيانات البصمة للشركة المصنعة": يتم تحديدها بواسطة مستخدمي المؤسسة (إداري أو مدير أعلى) بعد إرسال بيانات البيع وصورة البصمة للشركة المصنعة.
    *   "تم استلام الجواب من الشركة المصنعة (بواسطة المؤسسة)": يتم تحديدها بواسطة مستخدمي المؤسسة عند وصول الجواب الفعلي إلى مقر المؤسسة.
    *   "تم إرسال الجواب إلى نقطة البيع (الوكيل/المعرض)": يتم تحديدها بواسطة مستخدمي المؤسسة عند شحن الجواب إلى الوكيل أو المعرض الذي تمت فيه عملية البيع. **هذه هي المرحلة النهائية لتتبع الجواب في التطبيق**.
*   **آلية تحديث الحالة:** يجب أن يكون تغيير حالة الجواب **سهلاً جداً من خلال قائمة اختيار (Select Box / Dropdown menu)** لكل مرحلة، لتقليل الأخطاء وتسهيل العملية.
*   **مسؤولية تحديث الحالة:** **المدير الأعلى والمديرين الإداريين هم فقط من يمكنهم تحديث حالات تتبع الجواب**. الوكلاء ومستخدمو المعرض يمكنهم فقط رؤية الحالة وليس تعديلها.
*   **الرؤية للمستخدمين:**
    *   المديرين والإداريين: يمكنهم رؤية حالة تتبع الجواب لكل موتوسيكل مباع على مستوى المؤسسة كلها، مع إمكانية البحث والفرز داخل الشاشة المخصصة للجوبات. هذا يضمن عدم نسيان أي جواب أو تأخره.
    *   الوكلاء / مستخدمي المعرض: يمكنهم رؤية حالة تتبع الجواب للموتوسيكلات التي تم بيعها من مخزنهم فقط، وذلك أيضاً عبر الشاشة المخصصة للجوبات.
*   **الإشعارات المتعلقة بالجواب:** سيتم إرسال إشعارات فورية عند كل تغيير في حالة تتبع الجواب للمستخدمين المعنيين (المؤسسة والوكيل/المعرض).
*   **الصورة المجمعة للإشعار الأول ومشاركتها (خاص بالمديرين):** عند وصول إشعار للمديرين بوجود فاتورة بيع جديدة تتطلب إرسال بيانات للشركة المصنعة (كأول خطوة في تتبع الجواب)، يجب أن تظهر لهم **صورة مجمعة (Combined Image) تلقائياً** تحتوي على:
    *   صورة بصمة الموتور.
    *   صورة رقم الشاسيه.
    *   صورة وجه بطاقة المستهلك (العميل النهائي).
    *   يجب توفير إمكانية **مشاركة هذه الصورة المجمعة مباشرة عبر تطبيقات مثل واتساب (WhatsApp Web Integration)**، ليتمكن المدير من إرسالها بسهولة للشركة المصنعة. بعد مشاركة الصورة (أو اختيار تجاهل المشاركة)، يتمكن المدير من اختيار حالة "تم إرسال بيانات البصمة للشركة المصنعة" لهذه المعاملة.

#### **2.5. شاشة استعلام العملاء (للاستخدام الداخلي للموظفين والوكلاء):**
*   **المطلب:** هذه الشاشة مخصصة فقط **للاستخدام الداخلي** للمديرين، المديرين الإداريين، الوكلاء، ومستخدمي المعرض. (ليست للعملاء النهائيين مباشرة داخل التطبيق).
*   **الغرض:** تمكن المستخدمين من الاستعلام عن معلومات أي عميل نهائي قام بالشراء، ومراجعة بياناته ومستنداته.
*   **البحث بكل الطرق الممكنة:** يمكن للمستخدمين البحث عن العميل باستخدام أي من المعايير التالية: رقم الفاتورة، أو النص الرقمي لبصمة الموتور، أو رقم الشاسيه، أو الرقم القومي للعميل، أو اسم العميل.
*   **عرض التفاصيل:** بعد البحث، تعرض الشاشة:
    *   تفاصيل الفواتير التي تخص العميل (بالكامل).
    *   تفاصيل الأصناف التي اشتراها (بما في ذلك بصمة الموتور كرقم وصورتها، ورقم الشاسيه كرقم وصورته).
    *   حالة تتبع الجواب الخاص بكل موتوسيكل اشتراه العميل.
    *   القدرة على عرض وتحميل (Download) الصور المرتبطة بالعميل (صور بطاقة الهوية، صور بصمة الموتور، صور رقم الشاسيه).
*   **الصلاحيات:** أي مستخدم للتطبيق (مدير أعلى، إداري، وكيل، مستخدم معرض) يجب أن يكون لديه صلاحية البحث عن أي عميل ورؤية فواتيره بتفاصيلها الكاملة، وتفاصيل حالة الجواب الخاص بها، مع إمكانية عرض الصور المرتبطة (مثل صور البطاقة) لتسهيل المتابعة أو الرد على استفسارات العملاء.

### **3. نظام الصلاحيات المتقدم (Advanced Access Control System)**

يجب أن يكون التطبيق مزوداً بنظام صلاحيات دقيق لتحديد وصول المستخدمين للبيانات والوظائف المختلفة بناءً على دورهم.

#### **3.1. المدير الأعلى (Super Admin):**
*   **إدارة المستخدمين والتحكم في الحسابات:** هو الوحيد المخول بإضافة مستخدمين جدد للنظام، إنشاء حساباتهم (اسم المستخدم وكلمة المرور الأولية)، وتعيين نوع الصلاحية (الدور) لكل مستخدم (مدير إداري، وكيل، مستخدم معرض).
*   **ربط المستخدمين بالمخازن:** يجب أن يتمكن المدير الأعلى من ربط كل وكيل بمخزنه الخاص به، وربط مستخدمي المعرض بمخزن المعرض.
*   إمكانية تعديل بيانات أي مستخدم موجود أو تعطيل/تفعيل/حذف حساباتهم.
*   **الوصول الشامل للبيانات:** يمكنه رؤية جميع المخازن (الرئيسي، المعرض، الوكلاء)، جميع فواتير البيع للعملاء النهائيين، وجميع الفواتير المستحقة على الوكلاء، وجميع المدفوعات، وجميع التقارير.
*   **التقارير المالية الكاملة:** هو الوحيد الذي يمكنه رؤية التقارير الإجمالية للأرباح والخسائر للمؤسسة كلها (Overall Profit & Loss)، وتقارير أرصدة الوكلا
**الفكرة الجوهرية للتطبيق (Core Concept):**
التطبيق سيعمل كمنصة رقمية متكاملة لإدارة العمليات المالية والمخزنية لمؤسسة "آل فرحان" وفروعها ونقاط بيعها. يرتكز التصميم على دعم هيكل **متعدد المستخدمين (Multi-User Structure)**، حيث يمتلك كل مستخدم (مدير أعلى، مدير إداري، وكيل، مستخدم معرض) **صلاحيات محددة بدقة (Role-Based Access Control)** لضمان الأمان والخصوصية.

**أهم نقطة هنا: مفهوم الوكيل المتكامل:**
سيتم التعامل مع الوكلاء بطريقتين:
1.  **وكلاء يستخدمون التطبيق بأنفسهم (Agents with User Accounts):** وهؤلاء هم الوكلاء الذين يمتلكون حسابات على التطبيق، يمكنهم تسجيل الدخول، إدارة مخازنهم الفرعية الخاصة بهم، إنشاء فواتير البيع للعملاء النهائيين، ورؤية كشوفات حساباتهم.
2.  **وكلاء أوفلاين لا يمتلكون مستخدمين في التطبيق (Offline Agents without User Accounts):** وهؤلاء وكلاء خارجيون لا يستخدمون التطبيق مباشرة. **تتم إدارة جميع حساباتهم (البضاعة المحولة إليهم، مبيعاتهم التي تُبلغ للمؤسسة، ودفعاتهم المالية) بشكل كامل بواسطة المديرين الإداريين أو المدير الأعلى داخل التطبيق على حساب هذا الوكيل**.

**لكلا النوعين من الوكلاء، سيتم التعامل معهم كـ "عميل" للمؤسسة**. لهم حساب مالي خاص بهم يضم فواتير بضاعة مستحقة للمؤسسة ودفعات يقومون بها. **مديونيتهم تتغير بناءً على سعر البيع النهائي للعميل**، حيث تشمل مديونيته سعر الشراء الأصلي بالإضافة إلى نصيب المؤسسة من الربح بعد البيع النهائي للعميل. كل وكيل (سواء كان مستخدم للتطبيق أم لا) سيكون له مخزن مستقل مرتبط بحسابه.

**رؤية مستقبلية:** في المستقبل، سيتم تطوير نسخة من هذا التطبيق تعمل على نظام تشغيل Windows، لخدمة أجهزة الكمبيوتر المكتبية والمحمولة.

**الهدف الأساسي من التطبيق:**
رقمنة وتبسيط إدارة المخزون، عمليات البيع، تتبع الأرباح، وإدارة شاملة لحسابات الوكلاء كنظام عملاء/موردين (Vendors/Customers) مع المؤسسة ونقطة البيع الرئيسية للمؤسسة (المعرض)، بالإضافة إلى تتبع دقيق لعملية استخراج وتسليم "جواب" الموتوسيكل حتى وصوله لنقطة البيع.

**النتائج المرجوة من التطبيق (Desired Outcomes):**
يهدف التطبيق إلى تحقيق نظام محاسبي رقمي "لاورقي" (Paperless)، يقلل الأخطاء البشرية بشكل كبير، ويوفر رؤية شاملة ودقيقة لكل العمليات المالية والمخزنية. سيمكن كل طرف من الوصول الفوري للبيانات والمعلومات والصلاحيات الخاصة به فقط. هذا النظام سيضمن عدم نسيان أي خطوة في عملية وصول "الجواب" لنقطة البيع لتسليمه للعميل النهائي، وتسجيل جميع المعاملات المالية (فواتير البضاعة، المدفوعات، أرصدة مديونية الوكلاء المتغيرة بناءً على الأرباح) بين الوكلاء والمؤسسة بوضوح ودقة عالية. كما سيوفر قدرة بحث واستعلام شاملة للمستخدمين الداخليين عن كل ما يخص العملاء النهائيين ومشترياتهم.

### **2. الملامح الأساسية للتطبيق (Core Features)**

#### **2.1. إدارة المخزون وتفاصيل الأصناف (Inventory Management & Item Details):**

##### **2.1.1. شاشة تسجيل الأصناف (Item Registration Screen):**
*   إضافة تفاصيل كاملة لكل صنف جديد يدخل المخزن: النوع، الموديل، اللون، الماركة، بلد المنشأ، سنة الصنع، السعر الأساسي للشراء (التكلفة).
*   **إدارة رقم الشاسيه (Chassis Number) وبصمة الموتور كمعرفات فريدة مع دعم التعرف الضوئي على الحروف (OCR):**
    *   **المطلب الأهم والحاسم:** يجب التقاط **صورة واضحة لبصمة الموتور وصورة واضحة لرقم الشاسيه** لكل صنف بواسطة كاميرا التطبيق مباشرة.
    *   ستُستخدم **تقنية التعرف الضوئي على الحروف (OCR)** لتحليل الصور واستخلاص الأرقام والحروف منها وتحويلها تلقائياً إلى نصوص رقمية قابلة للبحث والتخزين لكل من بصمة الموتور ورقم الشاسيه.
    *   يجب أن يسمح التطبيق للمستخدم بـ**مراجعة وتعديل النصوص الرقمية المستخلصة من الـ OCR يدوياً** لضمان الدقة الكاملة قبل الحفظ. هذه الخطوة حاسمة لسلامة البيانات.
    *   سيتم تخزين كل من صور بصمة الموتور ورقم الشاسيه الأصلية (كمرجع مرئي وللتوثيق في الفواتير) والنصوص الرقمية المستخرجة والمعتمدة لكل منهما (للتتبع، البحث، الفرز، والظهور في الفواتير والتقارير).
    *   النص الرقمي لبصمة الموتور و/أو رقم الشاسيه سيكونان **معرّفين فريدين (Unique ID / Primary Key)** لكل صنف في قاعدة البيانات، مما يمنع تكرار الأصناف ويجعل تتبعها سهلاً ودقيقاً في جميع الحركات.

##### **2.1.2. تتبع المخزون عبر المخازن المتعددة (Multi-Warehouse Tracking):**
*   **المخزن الرئيسي للمؤسسة (Main Warehouse):** لإدارة الأصناف الجديدة الواردة إلى المؤسسة قبل توزيعها.
*   **مخزن المعرض (Showroom Warehouse):** يُعامل كمخزن فرعي ونقطة بيع رئيسية تابعة للمؤسسة. أي بيع يتم من هذا المخزن يذهب ربحه بالكامل للمؤسسة (لا تقسيم أرباح).
*   **مخازن الوكلاء (Agent Warehouses):** لكل وكيل مخزن فرعي خاص به. البضاعة المحولة إليه سيتم تسجيلها كـ**فاتورة مبيعات للمؤسسة على حساب الوكيل بقيمة سعر الشراء الأصلي، مما يؤثر على رصيده المالي كعميل**.

##### **2.1.3. شاشات عرض المخزون (Organized Inventory Display Screens):**
*   **شاشات المخازن عند المديرين يجب أن تكون مرتبة ومنظمة جيداً لتجنب اللخبطة، مع خيارات بحث وفرز واضحة**.
*   عرض المخزون الحالي لكل مخزن بشكل منفصل، مع إمكانية البحث والفرز بناءً على النص الرقمي لبصمة الموتور أو رقم الشاسيه أو أي تفاصيل أخرى.
*   إظهار تفاصيل الأصناف المتاحة، المباعة، أو المعلقة (تحت التحويل).

#### **2.2. إدارة المبيعات والفواتير (Sales & Invoicing Management):**

##### **2.2.1. إنشاء فواتير البيع للعملاء النهائيين (End-Customer Invoice Creation):**
*   شاشة مخصصة لإنشاء فواتير بيع رقمية مفصلة.
*   **بيانات العميل وتوثيق الهوية (OCR & Image Capture):**
    *   تسجيل شامل لاسم المشتري، رقم الهاتف، والعنوان.
    *   **المطلب الجديد:** يجب أن يطلب التطبيق **تصوير بطاقة الهوية الوطنية للعميل (وش وظهر)** باستخدام كاميرا التطبيق.
    *   يجب توجيه المستخدم بوضوح حول طريقة التصوير الصحيحة (إضاءة جيدة، زاوية مستقيمة، البطاقة داخل الإطار المحدد) لضمان جودة الصور القابلة للطباعة لاحقاً.
    *   ستُستخدم **تقنية OCR** لـاستخلاص البيانات الأساسية من البطاقة (مثل: الاسم بالكامل، الرقم القومي، العنوان، تاريخ الإصدار/الانتهاء) ووضعها في الحقول المخصصة بالفاتورة. يجب على المستخدم مراجعة وتأكيد دقة هذه البيانات.
    *   سيتم تخزين صور البطاقة (الوجهين) المرفقة مع بيانات الفاتورة.
*   تفاصيل الصنف المباع: اختيار الصنف عن طريق النص الرقمي لبصمة الموتور أو رقم الشاسيه الخاص به.
*   **إرفاق صور بصمة الموتور ورقم الشاسيه:** يجب أن تظهر صورة بصمة الموتور وصورة رقم الشاسيه بوضوح ضمن تفاصيل الفاتورة كدليل بصري ومرجع.
*   سعر البيع: إدخال سعر البيع النهائي للصنف.

##### **2.2.2. حساب الأرباح تلقائياً (Automated Profit Calculation):**
*   **لمبيعات من مخازن الوكلاء (عمولة متغيرة):** يُقسم الربح (سعر البيع النهائي للعميل - سعر الشراء/التكلفة الأساسية للمؤسسة) **بناءً على نسبة العمولة المحددة لكل موتوسيكل أثناء تحويله للوكيل**. **نصيب المؤسسة من المكسب (بناءً على العمولة المتغيرة) ستضاف إلى مديونية الوكيل الأصلية (قيمة سعر الشراء الأصلي للبضاعة المحولة إليه).**.
*   لمبيعات من المخزن الرئيسي أو مخزن المعرض: الربح بالكامل يذهب للمؤسسة (100%).
*   يجب أن تظهر نسبة الربح لكل طرف بوضوح في ملخص الفاتورة أو تقرير البيع.

##### **2.2.3. تسجيل حركات البيع والمرتجعات (Sales & Return Transaction Logging):**
*   كل عملية بيع أو ارتجاع ستُسجل بشكل مفصل مع تاريخ ووقت العملية، والمستخدم الذي قام بها.
*   **أرقام تسلسلية فريدة لكل حركة (Unique Transaction IDs):**
    *   الإدخالات المخزنية: رقم إدخال مخزني فريد (مثال: IN-YYMMDD-001).
    *   فواتير البضاعة المحولة للوكلاء: رقم فاتورة مبيعات للمؤسسة على الوكيل (مثال: INV-AGENT-YYMMDD-001). هذه الفواتير تنشأ عند تحويل البضاعة للوكيل.
    *   فواتير البيع للعملاء النهائيين: رقم فاتورة فريد (مثال: INV-YYMMDD-010).
    *   مرتجعات البيع: رقم مرتجع بيع فريد (مثال: RET-YYMMDD-001).
    *   سندات القبض (المدفوعات من الوكلاء): رقم سند قبض فريد (مثال: RCPT-YYMMDD-001).
    *   يجب أن يضمن النظام توليد هذه الأرقام بشكل آمن وفريد (لا تكرار)، مع تضمين التاريخ كجزء من الرقم لسهولة التتبع والفرز.
*   **التتبع الشامل ببصمة الموتور ورقم الشاسيه:** كل حركة في النظام يجب أن تكون مرتبطة بشكل مباشر بالنص الرقمي لبصمة الموتور ورقم الشاسيه الخاصة بالصنف، مما يتيح تتبع تاريخ الصنف بالكامل.

#### **2.3. إدارة حسابات الوكلاء (كنظام عملاء للمؤسسة - Agent as Customer System):**
*   **صفحة حساب الوكيل:** لكل وكيل (سواء مستخدم للتطبيق أو أوفلاين يديره إداريون) حساب خاص به يعرض:
    *   قائمة بالبضاعة الموجودة حالياً في مخزنه (مع بصماتها كـنص رقمي وأرقام الشاسيه).
    *   **الرصيد المالي المستحق على الوكيل للمؤسسة (مدين/دائن):** هذا الرصيد يجب أن يعكس إجمالي **المديونية المتغيرة** التي تشمل قيمة البضاعة المحولة إليه بسعر الشراء الأصلي، بالإضافة إلى نصيب المؤسسة من الأرباح المحققة من مبيعاته النهائية..
    *   سجل الفواتير المستحقة: عرض الفواتير التي تم إصدارها على الوكيل مقابل البضاعة المحولة إليه.
    *   **تسجيل الدفعات (سندات القبض - حصري للمديرين، ويشمل الوكلاء الأوفلاين):** شاشة مخصصة لـتسجيل الدفعات المالية التي قام بها الوكيل للمؤسسة، تتضمن (المبلغ، تاريخ الدفع، طريقة الدفع، ورقم سند القبض الفريد). **هذه الشاشة متاحة فقط للمدير الأعلى والمديرين الإداريين. الوكلاء لا يمكنهم تسجيل دفعات لأنفسهم**.
*   **القدرة على إنشاء فواتير بيع للعملاء النهائيين من مخزنه الخاص فقط.** (هذه الصلاحية خاصة بالوكلاء الذين يمتلكون حسابات على التطبيق، أما الوكلاء الأوفلاين فيتم تسجيل مبيعاتهم من قبل الإداريين).
*   **كشف حساب مفصل (بيان حركة):** إمكانية الوكيل (أو المدير/الإداري الذي يدير حساب وكيل أوفلاين) لرؤية كشف حساب مفصل يوضح:
    *   البضاعة التي استلمها من المؤسسة (مع روابط الفواتير المستحقة).
    *   جميع المبيعات التي قام بها للعملاء النهائيين، مع تفصيل نصيبه من الأرباح ونسبة المؤسسة.
    *   تفاصيل الدفعات التي قام بها للمؤسسة.
    *   حساب الرصيد المالي الحالي المتغير الذي يعكس كل هذه العمليات (المديونية الناتجة عن البضاعة ونسبة المؤسسة في الأرباح مطروحاً منها الدفعات).

#### **2.4. نظام تتبع "الجواب" (Document Tracking System):**
*   **شاشة مخصصة لتتبع الجوابات (Dedicated Document Tracking Screen):** يجب توفير شاشة منفصلة داخل التطبيق تعرض فقط حالات تتبع "الجوابات" (شهادات بيانات الموتوسيكلات)، لتسهيل المتابعة والبحث.
*   ربط تتبع الجواب بكل صنف مباع: كل موتوسيكل يتم بيعه (عن طريق فاتورة للعميل النهائي) سيكون له حالة تتبع خاصة بـ "الجواب" الخاص به.
*   **مراحل التتبع (قابلة للتخصيص ومحددة):**
    *   "تم إرسال بيانات البصمة للشركة المصنعة": يتم تحديدها بواسطة مستخدمي المؤسسة (إداري أو مدير أعلى) بعد إرسال بيانات البيع وصورة البصمة للشركة المصنعة.
    *   "تم استلام الجواب من الشركة المصنعة (بواسطة المؤسسة)": يتم تحديدها بواسطة مستخدمي المؤسسة عند وصول الجواب الفعلي إلى مقر المؤسسة.
    *   "تم إرسال الجواب إلى نقطة البيع (الوكيل/المعرض)": يتم تحديدها بواسطة مستخدمي المؤسسة عند شحن الجواب إلى الوكيل أو المعرض الذي تمت فيه عملية البيع. **هذه هي المرحلة النهائية لتتبع الجواب في التطبيق**.
*   **آلية تحديث الحالة:** يجب أن يكون تغيير حالة الجواب **سهلاً جداً من خلال قائمة اختيار (Select Box / Dropdown menu)** لكل مرحلة، لتقليل الأخطاء وتسهيل العملية.
*   **مسؤولية تحديث الحالة:** **المدير الأعلى والمديرين الإداريين هم فقط من يمكنهم تحديث حالات تتبع الجواب**. الوكلاء ومستخدمو المعرض يمكنهم فقط رؤية الحالة وليس تعديلها.
*   **الرؤية للمستخدمين:**
    *   المديرين والإداريين: يمكنهم رؤية حالة تتبع الجواب لكل موتوسيكل مباع على مستوى المؤسسة كلها، مع إمكانية البحث والفرز داخل الشاشة المخصصة للجوبات. هذا يضمن عدم نسيان أي جواب أو تأخره.
    *   الوكلاء / مستخدمي المعرض: يمكنهم رؤية حالة تتبع الجواب للموتوسيكلات التي تم بيعها من مخزنهم فقط، وذلك أيضاً عبر الشاشة المخصصة للجوبات.
*   **الإشعارات المتعلقة بالجواب:** سيتم إرسال إشعارات فورية عند كل تغيير في حالة تتبع الجواب للمستخدمين المعنيين (المؤسسة والوكيل/المعرض).
*   **الصورة المجمعة للإشعار الأول ومشاركتها (خاص بالمديرين):** عند وصول إشعار للمديرين بوجود فاتورة بيع جديدة تتطلب إرسال بيانات للشركة المصنعة (كأول خطوة في تتبع الجواب)، يجب أن تظهر لهم **صورة مجمعة (Combined Image) تلقائياً** تحتوي على:
    *   صورة بصمة الموتور.
    *   صورة رقم الشاسيه.
    *   صورة وجه بطاقة المستهلك (العميل النهائي).
    *   يجب توفير إمكانية **مشاركة هذه الصورة المجمعة مباشرة عبر تطبيقات مثل واتساب (WhatsApp Web Integration)**، ليتمكن المدير من إرسالها بسهولة للشركة المصنعة. بعد مشاركة الصورة (أو اختيار تجاهل المشاركة)، يتمكن المدير من اختيار حالة "تم إرسال بيانات البصمة للشركة المصنعة" لهذه المعاملة.

#### **2.5. شاشة استعلام العملاء (للاستخدام الداخلي للموظفين والوكلاء):**
*   **المطلب:** هذه الشاشة مخصصة فقط **للاستخدام الداخلي** للمديرين، المديرين الإداريين، الوكلاء، ومستخدمي المعرض. (ليست للعملاء النهائيين مباشرة داخل التطبيق).
*   **الغرض:** تمكن المستخدمين من الاستعلام عن معلومات أي عميل نهائي قام بالشراء، ومراجعة بياناته ومستنداته.
*   **البحث بكل الطرق الممكنة:** يمكن للمستخدمين البحث عن العميل باستخدام أي من المعايير التالية: رقم الفاتورة، أو النص الرقمي لبصمة الموتور، أو رقم الشاسيه، أو الرقم القومي للعميل، أو اسم العميل.
*   **عرض التفاصيل:** بعد البحث، تعرض الشاشة:
    *   تفاصيل الفواتير التي تخص العميل (بالكامل).
    *   تفاصيل الأصناف التي اشتراها (بما في ذلك بصمة الموتور كرقم وصورتها، ورقم الشاسيه كرقم وصورته).
    *   حالة تتبع الجواب الخاص بكل موتوسيكل اشتراه العميل.
    *   القدرة على عرض وتحميل (Download) الصور المرتبطة بالعميل (صور بطاقة الهوية، صور بصمة الموتور، صور رقم الشاسيه).
*   **الصلاحيات:** أي مستخدم للتطبيق (مدير أعلى، إداري، وكيل، مستخدم معرض) يجب أن يكون لديه صلاحية البحث عن أي عميل ورؤية فواتيره بتفاصيلها الكاملة، وتفاصيل حالة الجواب الخاص بها، مع إمكانية عرض الصور المرتبطة (مثل صور البطاقة) لتسهيل المتابعة أو الرد على استفسارات العملاء.

### **3. نظام الصلاحيات المتقدم (Advanced Access Control System)**

يجب أن يكون التطبيق مزوداً بنظام صلاحيات دقيق لتحديد وصول المستخدمين للبيانات والوظائف المختلفة بناءً على دورهم.

#### **3.1. المدير الأعلى (Super Admin):**
*   **إدارة المستخدمين والتحكم في الحسابات:** هو الوحيد المخول بإضافة مستخدمين جدد للنظام، إنشاء حساباتهم (اسم المستخدم وكلمة المرور الأولية)، وتعيين نوع الصلاحية (الدور) لكل مستخدم (مدير إداري، وكيل، مستخدم معرض).
*   **ربط المستخدمين بالمخازن:** يجب أن يتمكن المدير الأعلى من ربط كل وكيل بمخزنه الخاص به، وربط مستخدمي المعرض بمخزن المعرض.
*   إمكانية تعديل بيانات أي مستخدم موجود أو تعطيل/تفعيل/حذف حساباتهم.
*   **الوصول الشامل للبيانات:** يمكنه رؤية جميع المخازن (الرئيسي، المعرض، الوكلاء)، جميع فواتير البيع للعملاء النهائيين، وجميع الفواتير المستحقة على الوكلاء، وجميع المدفوعات، وجميع التقارير.
*   **التقارير المالية الكاملة:** هو الوحيد الذي يمكنه رؤية التقارير الإجمالية للأرباح والخسائر للمؤسسة كلها (Overall Profit & Loss)، وتقارير أرصدة الوكلاء الشاملة.
*   **إدارة بيانات المؤسسة:** التحكم الكامل في تفاصيل المؤسسة (تعديل الاسم، اللوجو، تحميل بوسترات جديدة لشاشة التحميل).
*   **التحكم الكامل في مراحل تتبع الجواب، بما في ذلك صلاحية تحديث الحالات**.
*   **القدرة على تسجيل المدفوعات من الوكلاء**.

#### **3.2. المستخدمون الإداريون (Admin Users):**
*   صلاحيات إدارة المخازن (المؤسسة والمعرض والوكلاء)، إضافة أصناف جديدة للمخزن الرئيسي، تحويل البضاعة (وإصدار فواتيرها للوكلاء)، مراجعة فواتير البيع للعملاء النهائيين.
*   **القدرة على تسجيل المدفوعات من الوكلاء.** (هذه الصلاحية تشمل تسجيل دفعات من **الوكلاء الذين يمتلكون حسابات في التطبيق**، وكذلك **الوكلاء الأوفلاين الذين لا يمتلكون حسابات**، حيث يقوم الإداريون بإدارة حساباتهم بالكامل).
*   **المساهمة في تتبع الجواب:** يمكنهم تحديث مراحل تتبع الجواب ذات الصلة بعمليات المؤسسة، وتوليد ومشاركة الصورة المجمعة للشركة المصنعة عند أول خطوة.
*   **نقطة مهمة:** **المديرون لا يمكنهم البيع من مخازن الوكلاء؛ صلاحيتهم على مخازن الوكلاء تقتصر على التحويلات المخزنية فقط**.
*   البحث عن العملاء: يمكنهم البحث عن أي عميل ورؤية فواتيره وتفاصيل حالة الجواب.
*   لا يمكنهم رؤية التقارير الإجمالية للأرباح أو تعديل بيانات المستخدمين أو صلاحياتهم.

#### **3.3. الوكلاء (Agents):**
*   **الوكلاء الذين يمتلكون حسابات في التطبيق:**
    *   الوصول لمخزنهم الخاص فقط، ورؤية الأصناف الموجودة لديهم (بصماتها كنص رقمي، أرقام الشاسيه).
    *   القدرة على إنشاء فواتير البيع للعملاء النهائيين من مخزنهم.
    *   رؤية نصيبهم فقط من الأرباح في الفواتير التي قاموا بإنشائها.
    *   **لا يمكنهم تسجيل الدفعات المالية لأنفسهم (هذه الصلاحية حصرية للمديرين فقط).**.
    *   رؤية كشف حسابهم المفصل الذي يوضح فواتير البضاعة التي أخذوها، المدفوعات التي قاموا بها، ورصيدهم المالي الحالي المتغير مع المؤسسة.
    *   المساهمة في تتبع الجواب: يمكنهم رؤية حالة تتبع الجواب للموتوسيكلات المباعة من مخزنهم عبر الشاشة المخصصة، ولكن لا يمكنهم تحديث حالات الجواب.
    *   البحث عن العملاء: يمكنهم البحث عن أي عميل ورؤية فواتيره وتفاصيل حالة الجواب.
    *   لا يمكنهم رؤية مخازن أو أرباح أي وكيل آخر أو المؤسسة ككل.
*   **الوكلاء الأوفلاين الذين لا يمتلكون مستخدمين في التطبيق:**
    *   حساباتهم ومخازنهم تدار بشكل كامل من قبل المديرين الإداريين أو المدير الأعلى [من طلب المستخدم].
    *   الإداريون هم من يقومون بتسجيل البضاعة المحولة إليهم، وتسجيل مبيعاتهم (التي تُبلغ لهم)، وتسجيل دفعاتهم المالية.
    *   كشف حسابهم ورصيدهم المالي (المديونية المتغيرة) تتم إدارتها ومتابعتها وعرضها من قِبل المديرين والإداريين.

#### **3.4. مستخدمو المعرض (Showroom Users):**
*   صلاحيات إدارة مخزن المعرض فقط، وإنشاء فواتير البيع للعملاء النهائيين منه.
*   لا يوجد تقسيم أرباح لهم، فالأرباح تذهب بالكامل للمؤسسة (100%).
*   المساهمة في تتبع الجواب: يمكنهم رؤية حالة تتبع الجواب للموتوسيكلات المباعة من المعرض عبر الشاشة المخصصة، ولكن لا يمكنهم تحديث حالات الجواب.
*   البحث عن العملاء: يمكنهم البحث عن أي عميل ورؤية فواتيره وتفاصيل حالة الجواب.

### **4. المتطلبات التقنية والوظيفية الخاصة (Specific Technical & Functional Requirements)**

#### **4.1. المزامنة والتخزين (Synchronization & Storage):**
*   **العمل أوفلاين أولاً (Offline First):** التطبيق يجب أن يعمل بشكل كامل وفعال في وضع عدم الاتصال بالإنترنت. سيتمكن المستخدمون (المديرون، الوكلاء الذين يمتلكون حسابات، مستخدمو المعرض) من إدخال البيانات، إنشاء الفواتير، التقاط الصور، والوصول للبيانات المخزنة محلياً.
*   **المزامنة الذكية والفعالة مع Firebase Cloud Firestore:**
    *   عند الاتصال بالإنترنت، يقوم التطبيق تلقائياً وبسرعة بمزامنة جميع البيانات الجديدة والمعدلة بين جميع الأجهزة.
    *   **ضمان سلامة البيانات ومنع الأخطاء:** Firebase Cloud Firestore مصمم للمزامنة في الوقت الفعلي ويقدم آليات قوية لضمان دقة البيانات وتجنب التكرار أو التلف.
    *   **قواعد أمان Firestore (Firestore Security Rules):** سيتم تطبيق قواعد صارمة لتحديد من يمكنه قراءة أو كتابة أي بيانات، ومنع التكرار (مثال: منع إضافة صنف إذا كانت بصمة الموتور أو رقم الشاسيه مكرراً).
*   **تخزين الصور الخارجية (External Image Storage):**
    *   نظراً لأن Firebase Firestore (في الخطة المجانية) ليس مخصصاً لتخزين الصور مباشرة بكميات كبيرة، سيتم تخزين صور بصمة الموتور، رقم الشاسيه، وبطاقة الهوية للعملاء على خدمة سحابية خارجية مجانية أو منخفضة التكلفة (مثل Cloudinary أو Google Drive API).
    *   سيتم تخزين **روابط (URLs) هذه الصور فقط** في Firebase Firestore، مما يحافظ على حجم البيانات في Firestore ويحسن الأداء.

#### **4.2. نظام التقارير الشاملة (Comprehensive Reporting System):**
*   توفر شاشات مخصصة لإنشاء تقارير مفصلة ودقيقة عن:
    *   المخزون الحالي (بصمات كنص رقمي، أرقام شاسيه، أعداد متوفرة، قيمة تقديرية).
    *   المبيعات (تقارير يومية، أسبوعية، شهرية، سنوية، تقارير مبيعات حسب الصنف، حسب الوكيل، حسب الفترة الزمنية).
    *   الأرباح (إجمالي الربح، نصيب المؤسسة من الربح، نصيب الوكيل من الربح).
    *   حركة البضاعة بين المخازن (تحويلات واردة وصادرة).
    *   كشوفات حسابات الوكلاء المالية (بيان حركة شامل للفواتير والدفعات والأرصدة المتغيرة).
    *   تقارير تتبع الجواب: عرض حالة الجواب لكل موتوسيكل مباع.
*   إمكانية البحث المتقدم في التقارير: بناءً على رقم الفاتورة (للعميل أو الوكيل)، اسم العميل/الوكيل، النص الرقمي لبصمة الموتور، رقم الشاسيه، التواريخ، أو أي بيانات ذات صلة.
*   القدرة على تصدير التقارير إلى صيغ شائعة قابلة للتحليل مثل Microsoft Excel (CSV/XLSX) و PDF.
*   **التقارير الإجمالية للأرباح والخسائر للمؤسسة متاحة فقط للمدير الأعلى**.
*   **إمكانية طباعة الفواتير:** تصميم الفواتير بحيث تكون قابلة للطباعة بشكل منظم وواضح، بما في ذلك صور بصمة الموتور وصور بطاقة العميل (الوش والظهر) مع بياناتها المستخلصة.

#### **4.3. تصميم واجهة المستخدم (UI) وتجربة المستخدم (UX):**
*   تصميم واجهة مستخدم عصرية، نظيفة، أنيقة، وعملية تعكس هوية مؤسسة آل فرحان وتكون سهلة الاستخدام لجميع الفئات (سهولة التنقل، وضوح الأزرار، قلة الخطوات لكل عملية).
*   استخدام لوحة ألوان متناسقة، خطوط واضحة ومقروءة، وأيقونات سهلة الفهم ومعبرة عن وظائفها.
*   **ملاحظة هامة جداً حول التصميم: يجب أن يكون التصميم نهائياً واحترافياً من البداية. لا يجب استخدام أي أيقونات مبدئية (placeholder icons) أو عناصر تصميمية مؤقتة (wireframe-like elements) "كسد خانة". كل عنصر في الواجهة يجب أن يكون جزءاً من التصميم النهائي الجمالي والوظيفي.**.
*   **شاشة تحميل (Splash Screen) ديناميكية وقابلة للتخصيص:** يجب أن تكون هناك شاشة تحميل جذابة تظهر عند فتح التطبيق. المدير الأعلى يمكنه تعديل البوستر أو اللوجو الظاهر في هذه الشاشة من خلال إعدادات التطبيق، وهذا التغيير يجب أن يظهر تلقائياً عند جميع المستخدمين الآخرين عند المزامنة.

#### **4.4. نظام الإشعارات الفورية (Push Notifications) باستخدام Firebase Cloud Messaging (FCM):**
*   تطبيق نظام إشعارات قوي لضمان التواصل الفوري بين الأطراف المختلفة في النظام.
*   **أنواع الإشعارات المقترحة:**
    *   للوكيل (الذين يمتلكون حسابات): "تم تحويل بضاعة جديدة إلى مخزنك."، "تم بيع صنف من مخزنك بواسطة مستخدم آخر (إذا كان الوكيل لديه أكثر من مستخدم)"، "تم تحديث بيانات صنف في مخزنك من قِبل المسؤول."، "تم إصدار فاتورة بضاعة جديدة على حسابك رقم [رقم الفاتورة]."، "تم تسجيل دفعة مالية منك رقم [رقم السند]."، "تنبيه: رصيدك المستحق للمؤسسة يتجاوز [المبلغ]."، "تمت الموافقة على طلب مرتجعك رقم [رقم المرتجع].".
    *   للمسؤولين والإداريين: "قام الوكيل [اسم الوكيل] بإنشاء فاتورة بيع رقم [رقم الفاتورة]."، "تم بيع صنف من مخزن المعرض رقم [رقم الفاتورة]."، "تنبيه: مخزن [اسم المخزن] أصبح مخزونه منخفضاً من صنف [اسم الصنف]."، "طلب مرتجع جديد من [اسم الوكيل] رقم [رقم المرتجع].".
    *   إشعارات تتبع الجواب: "تم إرسال بيانات بصمة الموتور [بصمة] للشركة المصنعة."، "تم استلام جواب الموتور [بصمة] من الشركة المصنعة."، "تم إرسال جواب الموتور [بصمة] إلى نقطة البيع [الوكيل/المعرض]."، "جواب الموتور [بصمة] جاهز للاستلام في نقطة البيع.".
    *   إشعارات عامة: إشعارات بتحديثات مهمة في بيانات المؤسسة أو التطبيق أو تنبيهات إدارية.
*   يجب أن يتضمن التطبيق إعدادات تسمح لكل مستخدم بتخصيص الإشعارات التي يرغب في استلامها (تفعيل/تعطيل أنواع معينة من الإشعارات).

### **5. متطلبات أمنية وصيانة (Security & Maintenance Requirements)**

#### **5.1. أمان البيانات (Data Security):**
*   تطبيق Firebase Security Rules قوية ومحكمة لضمان أن كل مستخدم يصل إلى البيانات المسموح له بها فقط، وحماية البيانات من الوصول غير المصرح به.
*   تشفير البيانات المخزنة محليًا على الأجهزة لضمان الحماية في حالة فقدان الجهاز أو سرقته.
*   إدارة آمنة لكلمات المرور وتدفق المصادقة (Authentication Flow) للمستخدمين.

#### **5.2. النسخ الاحتياطي واستعادة البيانات (Backup & Data Recovery):**
*   آلية لعمل نسخ احتياطية للبيانات (قد يتم دمجها مع خدمات جوجل السحابية مثل Google Drive بشكل مشفر).

#### **5.3. سهولة الاستخدام وقابلية التوسع (User Friendliness & Scalability):**
*   تصميم واجهة بديهية وسلسة لجميع أنواع المستخدمين، مع التركيز على تبسيط العمليات وتجربة المستخدم لتكون فعالة وغير معقدة، خاصة للوكلاء.
*   الهيكل المعماري للتطبيق يجب أن يدعم قابلية التوسع (Scalability) لاستيعاب زيادة في عدد المستخدمين أو حجم البيانات مستقبلاً دون الحاجة لإعادة هيكلة كبيرة.

#### **5.4. تحديثات التطبيق (App Updates):**
*   آلية سهلة لتوزيع وتثبيت التحديثات الجديدة للتطبيق على أجهزة المستخدمين.

---

